pool:
  vmImage: ubuntu-18.04

stages:
  - stage: Build
    jobs:
      - job: build
        displayName: Build
        steps:
          - bash: make build
            displayName: Build
  - stage: Deploy
    jobs:
      - job: build
        displayName: Deploy
        condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
        steps:
          - task: InstallSSHKey@0
            displayName: "Install SSH Key"
            inputs:
              knownHostsEntry: "ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDk/UA5tzxpA+1tmKJXDKFwo1JaJejfMdQOHnld7gkYa7Lqtwuo3zthEnFhLMOtMAlfGzC9xsfM0sX4aL2T39Bw="
              sshPublicKey: "$(id_rsa_pub)"
              sshKeySecureFile: "id_rsa"
          - bash: make build
            displayName: Build
          - bash: ssh dev@45.56.79.149 echo '$(pwd)'
            displayName: Deploy
